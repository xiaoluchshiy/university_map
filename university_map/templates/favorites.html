<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ò–∑–±—Ä–∞–Ω–Ω—ã–µ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—ã - UniMap</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary: #667eea;
            --secondary: #764ba2;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f8f9fa;
            color: #333;
        }

        .navbar {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
        }

        .favorites-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }

        .page-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: #2c5aa0;
            margin-bottom: 2rem;
            text-align: center;
        }

        .favorite-card {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            border-left: 4px solid var(--primary);
            transition: transform 0.3s ease;
        }

        .favorite-card:hover {
            transform: translateY(-5px);
        }

        .university-name {
            font-size: 1.3rem;
            font-weight: 700;
            color: #2c5aa0;
            margin-bottom: 0.5rem;
        }

        .university-type {
            color: #6c757d;
            font-size: 1rem;
            margin-bottom: 0.5rem;
        }

        .university-coords {
            color: #888;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #6c757d;
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 1rem;
            color: #dee2e6;
        }

        .btn-back {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .btn-back:hover {
            background: #5a6fd8;
            color: white;
            text-decoration: none;
            transform: translateY(-2px);
        }

        .favorite-count {
            background: var(--primary);
            color: white;
            border-radius: 20px;
            padding: 5px 15px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .type-icon {
            font-size: 1.2em;
            margin-right: 8px;
        }

        .university-type-badge {
            background: #667eea;
            color: white;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        /* –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ */
        .btn-modern {
            padding: 10px 18px;
            border-radius: 10px;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            border: none;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .btn-modern:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .btn-show-map {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-show-map:hover {
            background: linear-gradient(135deg, #5a6fd8, #6a4190);
            color: white;
        }

        .btn-remove {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            color: white;
        }

        .btn-remove:hover {
            background: linear-gradient(135deg, #ff5252, #e53935);
            color: white;
        }

        .buttons-container {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <nav class="navbar navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand logo" href="/">
                <i class="fas fa-graduation-cap"></i> UniMap
            </a>
            <div class="navbar-nav ml-auto">
                <a class="nav-link text-white" href="/map">
                    <i class="fas fa-map-marked-alt"></i> –ö–∞—Ä—Ç–∞
                </a>
                <a class="nav-link text-white" href="/profile">
                    <i class="fas fa-user"></i> –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç
                </a>
                <a class="nav-link text-white" href="/logout">
                    <i class="fas fa-sign-out-alt"></i> –í—ã–π—Ç–∏
                </a>
            </div>
        </div>
    </nav>

    <div class="favorites-container">
        <h1 class="page-title">
            <i class="fas fa-heart" style="color: #e74c3c;"></i>
            –ò–∑–±—Ä–∞–Ω–Ω—ã–µ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—ã
            {% if favorites %}
            <span class="favorite-count">{{ favorites|length }}</span>
            {% endif %}
        </h1>

        <div class="mb-4">
            <a href="/map" class="btn-back">
                <i class="fas fa-arrow-left"></i>
                –ù–∞–∑–∞–¥ –∫ –∫–∞—Ä—Ç–µ
            </a>
        </div>

        {% if favorites %}
            <div class="row">
                {% for uni in favorites %}
                <div class="col-lg-6">
                    <div class="favorite-card" data-type="{{ uni.type }}">
                        <div class="university-name">
                            <span class="type-icon" id="icon-{{ uni.id }}">üéì</span>{{ uni.title }}
                        </div>
                        <div class="university-type">
                            <strong>–¢–∏–ø:</strong> <span class="university-type-badge" id="type-{{ uni.id }}">{{ uni.type }}</span>
                        </div>
                        <div class="university-coords">
                            <strong>–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã:</strong> {{ "%.4f, %.4f"|format(uni.lat, uni.lon) }}
                        </div>
                        <div class="buttons-container">
                            <a href="/map" class="btn-modern btn-show-map">
                                <i class="fas fa-map-marker-alt"></i> –ü–æ–∫–∞–∑–∞—Ç—å –Ω–∞ –∫–∞—Ä—Ç–µ
                            </a>
                            <button class="btn-modern btn-remove remove-favorite" data-id="{{ uni.id }}">
                                <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å
                            </button>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="empty-state">
                <i class="fas fa-heart-broken"></i>
                <h3>–ü–æ–∫–∞ –Ω–µ—Ç –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–æ–≤</h3>
                <p>–î–æ–±–∞–≤—å—Ç–µ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—ã –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ –Ω–∞ –∫–∞—Ä—Ç–µ, —á—Ç–æ–±—ã –æ–Ω–∏ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å –∑–¥–µ—Å—å</p>
                <a href="/map" class="btn btn-primary">
                    <i class="fas fa-map-marked-alt"></i> –ü–µ—Ä–µ–π—Ç–∏ –∫ –∫–∞—Ä—Ç–µ
                </a>
            </div>
        {% endif %}
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∫–æ–Ω–æ–∫ –∏ –Ω–∞–∑–≤–∞–Ω–∏–π —Ç–∏–ø–æ–≤
        function getTypeIcon(type) {
            const icons = {
                'federal': 'üèõÔ∏è', 'technical': 'üîß', 'medical': '‚öïÔ∏è', 'pedagogical': 'üë®‚Äçüè´',
                'humanitarian': 'üìö', 'economic': 'üíº', 'architecture': 'üèóÔ∏è', 'linguistic': 'üî§',
                'social': 'üë•', 'veterinary': 'üêæ', 'food_tech': 'üçï', 'technology': '‚öôÔ∏è',
                'art': 'üé®', 'culture': 'üé≠'
            };
            return icons[type] || 'üéì';
        }

        function getTypeName(type) {
            const types = {
                'federal': '–§–µ–¥–µ—Ä–∞–ª—å–Ω—ã–π —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç', 'technical': '–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –≤—É–∑',
                'medical': '–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç', 'pedagogical': '–ü–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫–∏–π —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç',
                'humanitarian': '–ì—É–º–∞–Ω–∏—Ç–∞—Ä–Ω—ã–π —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç', 'economic': '–≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç',
                'architecture': '–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –∏–Ω—Å—Ç–∏—Ç—É—Ç', 'linguistic': '–õ–∏–Ω–≥–≤–∏—Å—Ç–∏—á–µ—Å–∫–∏–π —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç',
                'social': '–°–æ—Ü–∏–∞–ª—å–Ω—ã–π —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç', 'veterinary': '–í–µ—Ç–µ—Ä–∏–Ω–∞—Ä–Ω–∞—è –∞–∫–∞–¥–µ–º–∏—è',
                'food_tech': '–ü–∏—â–µ–≤–æ–π —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç', 'technology': '–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç',
                'art': '–•—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –∞–∫–∞–¥–µ–º–∏—è', 'culture': '–ò–Ω—Å—Ç–∏—Ç—É—Ç –∫—É–ª—å—Ç—É—Ä—ã'
            };
            return types[type] || '–£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç';
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–∫–æ–Ω–∫–∏ –∏ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–∏–ø–æ–≤ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–æ–≤
            document.querySelectorAll('.favorite-card').forEach(card => {
                const type = card.getAttribute('data-type');
                const cardId = card.querySelector('.remove-favorite').getAttribute('data-id');

                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–∫–æ–Ω–∫—É
                const iconElement = document.getElementById('icon-' + cardId);
                if (iconElement) {
                    iconElement.textContent = getTypeIcon(type);
                }

                // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–∏–ø–∞
                const typeElement = document.getElementById('type-' + cardId);
                if (typeElement) {
                    typeElement.textContent = getTypeName(type);
                }
            });
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —É–¥–∞–ª–µ–Ω–∏—è –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.remove-favorite').forEach(button => {
                button.addEventListener('click', function() {
                    const universityId = this.getAttribute('data-id');
                    const card = this.closest('.favorite-card');

                    fetch('/toggle_favorite/' + universityId, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        }
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            card.style.opacity = '0.5';
                            setTimeout(() => {
                                card.remove();
                                // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–∞
                                location.reload();
                            }, 300);
                        } else {
                            alert('–û—à–∏–±–∫–∞: ' + data.error);
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞');
                    });
                });
            });
        });
    </script>
</body>
</html>