<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UniMap - –ö–∞—Ä—Ç–∞ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–æ–≤</title>

    <!-- –Ø–Ω–¥–µ–∫—Å –ö–∞—Ä—Ç—ã -->
    <script src="https://api-maps.yandex.ru/2.1/?apikey=58536896-e96c-40b7-a0c7-f6717d975d29&lang=ru_RU"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #1a1a1a; }

        /* –ö–∞—Ä—Ç–∞ –∑–∞–Ω–∏–º–∞–µ—Ç –≤–µ—Å—å —ç–∫—Ä–∞–Ω */
        #map {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        /* –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–ª–µ–≤–∞ */
        .control-panel {
            position: fixed;
            top: 15px;
            left: 15px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .control-btn {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: none;
            border-radius: 12px;
            padding: 12px 18px;
            font-weight: 600;
            color: #333;
            text-decoration: none;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            transition: all 0.3s ease;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 140px;
        }
        .control-btn:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 12px 30px rgba(102,126,234,0.3);
            text-decoration: none;
        }

        .user-menu {
            display: flex;
            flex-direction: column;
            gap: 8px;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(20px);
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            min-width: 160px;
        }
        .user-info { font-weight: 600; color: #2c5aa0; margin-bottom: 8px; font-size: 14px; }

        /* –ü–∞–Ω–µ–ª—å —Ñ–∏–ª—å—Ç—Ä–æ–≤ —Å–ø—Ä–∞–≤–∞ */
        .filter-panel {
            position: fixed;
            top: 15px;
            right: 15px;
            z-index: 1000;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(20px);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            width: 250px;
            max-width: 90%;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .filter-title { font-weight: 700; color: #2c5aa0; margin-bottom: 15px; font-size: 16px; display: flex; align-items: center; gap: 8px; }
        .filter-group { display: flex; flex-direction: column; gap: 5px; }
        .filter-label { font-weight: 600; color: #333; font-size: 14px; }
        .filter-select { width: 100%; padding: 8px 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 14px; background: white; }
        .filter-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            font-size: 14px;
            padding: 5px 0;
        }

        .filter-checkbox input[type="checkbox"] {
            width: 18px;
            height: 18px;
            margin: 0;
            cursor: pointer;
            border: 2px solid #667eea;
            border-radius: 4px;
            appearance: none;
            -webkit-appearance: none;
            outline: none;
            transition: all 0.2s ease;
            position: relative;
        }

        .filter-checkbox input[type="checkbox"]:checked {
            background-color: #667eea;
            border-color: #667eea;
        }

        .filter-checkbox input[type="checkbox"]:checked::after {
            content: '‚úì';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: bold;
            font-size: 12px;
        }

        .filter-checkbox label {
            cursor: pointer;
            color: #333;
            font-weight: 600;
            user-select: none;
            margin: 0;
        }

        .filter-checkbox:hover input[type="checkbox"] {
            border-color: #5a6fd8;
        }

        .filter-checkbox:hover input[type="checkbox"]:checked {
            background-color: #5a6fd8;
            border-color: #5a6fd8;
        }
        /* –ö–Ω–æ–ø–∫–∞ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –Ω–∞ –≤—Å—é —à–∏—Ä–∏–Ω—É */
        .filter-panel button[type="submit"] {
            width: 100%;
            padding: 10px;
            border-radius: 10px;
            font-weight: 600;
            background: #667eea;
            color: white;
            border: none;
            transition: all 0.3s ease;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 5px;
        }
        .filter-panel button[type="submit"]:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }

        @media (max-width: 768px) {
            .control-panel { flex-direction: row; flex-wrap: wrap; left: 15px; right: 15px; }
            .filter-panel { top: 80px; left: 15px; right: 15px; width: auto; }
            .control-btn { min-width: auto; flex: 1; }
        }
    </style>
</head>
<body>
    <!-- –ü–ê–ù–ï–õ–¨ –£–ü–†–ê–í–õ–ï–ù–ò–Ø -->
    <div class="control-panel">
        <a href="/" class="control-btn"><i class="fas fa-home"></i> –ì–ª–∞–≤–Ω–∞—è</a>

        {% if current_user.is_authenticated %}
        <div class="user-menu">
            <div class="user-info"><i class="fas fa-user"></i> {{ current_user.name }}</div>
            <a href="/profile" class="control-btn" style="background: rgba(102,126,234,0.1);"><i class="fas fa-user-circle"></i> –ö–∞–±–∏–Ω–µ—Ç</a>
            <a href="/favorites" class="control-btn" style="background: rgba(231,76,60,0.1);"><i class="fas fa-heart"></i> –ò–∑–±—Ä–∞–Ω–Ω–æ–µ</a>
            <a href="/logout" class="control-btn" style="background: rgba(108,117,125,0.1);"><i class="fas fa-sign-out-alt"></i> –í—ã–π—Ç–∏</a>
        </div>
        {% else %}
        <a href="/login" class="control-btn"><i class="fas fa-sign-in-alt"></i> –í–æ–π—Ç–∏</a>
        <a href="/register" class="control-btn"><i class="fas fa-user-plus"></i> –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
        {% endif %}
    </div>

    <!-- –ü–ê–ù–ï–õ–¨ –§–ò–õ–¨–¢–†–û–í -->
    <form class="filter-panel" method="get" action="{{ url_for('index') }}">
        <div class="filter-title"><i class="fas fa-filter"></i> –§–∏–ª—å—Ç—Ä—ã</div>

        <div class="filter-group">
            <label class="filter-label">–¢–∏–ø —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–∞:</label>
            <select class="filter-select" name="type">
                <option value="all" {% if selected_type == 'all' %}selected{% endif %}>–í—Å–µ —Ç–∏–ø—ã</option>
                <option value="federal" {% if selected_type == 'federal' %}selected{% endif %}>–§–µ–¥–µ—Ä–∞–ª—å–Ω—ã–µ</option>
                <option value="technical" {% if selected_type == 'technical' %}selected{% endif %}>–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ</option>
                <option value="medical" {% if selected_type == 'medical' %}selected{% endif %}>–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ</option>
                <option value="pedagogical" {% if selected_type == 'pedagogical' %}selected{% endif %}>–ü–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫–∏–µ</option>
                <option value="humanitarian" {% if selected_type == 'humanitarian' %}selected{% endif %}>–ì—É–º–∞–Ω–∏—Ç–∞—Ä–Ω—ã–µ</option>
                <option value="economic" {% if selected_type == 'economic' %}selected{% endif %}>–≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–µ</option>
                <option value="architecture" {% if selected_type == 'architecture' %}selected{% endif %}>–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ</option>
                <option value="linguistic" {% if selected_type == 'linguistic' %}selected{% endif %}>–õ–∏–Ω–≥–≤–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ</option>
                <option value="social" {% if selected_type == 'social' %}selected{% endif %}>–°–æ—Ü–∏–∞–ª—å–Ω—ã–µ</option>
                <option value="veterinary" {% if selected_type == 'veterinary' %}selected{% endif %}>–í–µ—Ç–µ—Ä–∏–Ω–∞—Ä–Ω—ã–µ</option>
                <option value="food_tech" {% if selected_type == 'food_tech' %}selected{% endif %}>–ü–∏—â–µ–≤—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏</option>
                <option value="technology" {% if selected_type == 'technology' %}selected{% endif %}>–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ</option>
                <option value="art" {% if selected_type == 'art' %}selected{% endif %}>–ò—Å–∫—É—Å—Å—Ç–≤–æ</option>
                <option value="culture" {% if selected_type == 'culture' %}selected{% endif %}>–ö—É–ª—å—Ç—É—Ä–∞</option>
                <option value="space" {% if selected_type == 'space' %}selected{% endif %}>–ö–æ—Å–º–∏—á–µ—Å–∫–∏–µ</option>
            </select>
        </div>

        {% if current_user.is_authenticated %}
        <div class="filter-group">
        <div class="filter-checkbox">
            <input type="checkbox" id="onlyFavorites" name="fav" value="1" {% if only_favorites == '1' %}checked{% endif %}>
            <label for="onlyFavorites">–¢–æ–ª—å–∫–æ –∏–∑–±—Ä–∞–Ω–Ω—ã–µ</label>
        </div>
</div>
        {% endif %}

        <button type="submit"><i class="fas fa-check"></i> –ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
    </form>

    <!-- –ö–ê–†–¢–ê -->
    <div id="map"></div>

    <script>
        ymaps.ready(initMap);

        function initMap() {
            var map = new ymaps.Map("map", {
                center: [55.7558, 37.6176],
                zoom: 10,
                controls: []
            });

            const icons = {
                'federal':'üèõÔ∏è','technical':'üîß','medical':'‚öïÔ∏è','pedagogical':'üë®‚Äçüè´','humanitarian':'üìö',
                'economic':'üíº','architecture':'üèóÔ∏è','linguistic':'üî§','social':'üë•','veterinary':'üêæ',
                'food_tech':'üçï','technology':'‚öôÔ∏è','art':'üé®','culture':'üé≠','space':'üöÄ'
            };

            const colors = {
                'federal':'#4a6fc9','technical':'#e74c3c','medical':'#2ecc71','pedagogical':'#9b59b6','humanitarian':'#3498db',
                'economic':'#f39c12','architecture':'#e67e22','linguistic':'#1abc9c','social':'#95a5a6','veterinary':'#8e44ad',
                'food_tech':'#d35400','technology':'#c0392b','art':'#e84393','culture':'#0984e3','space':'#8e44ad'
            };

            {% for place in places %}
            var placemark = new ymaps.Placemark([{{ place.lat }}, {{ place.lon }}], {
                balloonContentHeader: `<div style="background:#667eea;color:white;padding:10px;border-radius:10px 10px 0 0;font-weight:700;">${icons['{{ place.type }}']} {{ place.title }}</div>`,
                balloonContentBody: `
                    <div style="padding:10px;">
                        <div style="margin-bottom:5px;"><strong>–¢–∏–ø:</strong> {{ place.type }}</div>
                        <div style="margin-bottom:5px;"><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> {{ place.description }}</div>
                        {% if place.website %}
                        <a href="{{ place.website }}" target="_blank" style="color:#10b981;text-decoration:none;">–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å–∞–π—Ç</a>
                        {% endif %}
                        <form method="post" action="{{ url_for('toggle_favorite', university_id=place.id) }}" style="margin-top:5px;">
                            <button type="submit" style="background:{{ 'red' if place.is_favorite else 'white' }};color:{{ 'white' if place.is_favorite else 'red' }};border:2px solid red;padding:5px 10px;border-radius:5px;">
                                {{ '–í –∏–∑–±—Ä–∞–Ω–Ω–æ–º' if place.is_favorite else '–í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ' }}
                            </button>
                        </form>
                    </div>
                `,
                hintContent: "{{ place.title }}"
            }, {
                preset: 'islands#circleIcon',
                iconColor: colors['{{ place.type }}']
            });

            map.geoObjects.add(placemark);
            {% endfor %}
        }
    </script>
</body>
</html>
